// Generated by ReluxScript compiler
// Do not edit manually

module.exports = function({ types: t }) {
  const builder = {
    _output: [],
    _indentLevel: 0,
    append(s) { this._output.push(s); },
    newline() { this._output.push('\n'); },
    indent() { this._indentLevel++; },
    dedent() { this._indentLevel--; },
    toString() { return this._output.join(''); }
  };
  
  
  class ComponentMetadata {
  constructor(name, has_state, has_effects) {
      this.name = name;
      this.has_state = has_state;
      this.has_effects = has_effects;
    }
  }
  
  
  class State {
  constructor(builder, components, current_component) {
      this.builder = builder;
      this.components = components;
      this.current_component = current_component;
    }
  }
  
  
  function is_component(name) {
    if ((name.length === 0)) {
      return false;
    }
    const first = name[0];
    return (first === first.toUpperCase());
  }
  
  
  function sanitize_name(name) {
    if ((name.length === 0)) {
      return name;
    }
    const first = name[0];
    return `${first.toUpperCase()}${name.slice(1)}`;
  }
  
  
  function get_callee_name(callee) {
    const __iflet_0 = callee;
    if (__iflet_0 !== null) {
      const id = __iflet_0;
      id.name;
    } else {
      null;
    }
  }
  
  
  function extract_state_var() {
    const __iflet_1 = this.state.current_component;
    if (__iflet_1 !== null && __iflet_1 !== undefined) {
      const component_name = __iflet_1;
      const sanitized = sanitize_name(component_name);
      const updated_components = this.state.components.map((c) => (() => {
        if ((c.name === sanitized)) {
          return { name: c.name, has_state: true, has_effects: c.has_effects };
        } else {
          return c;
        }
      })());
      this.state.components = updated_components;
    }
    this.state.builder.push("    private object _state;");
    return this.state.builder.push("\n");
  }
  
  
  function extract_effect() {
    const __iflet_2 = this.state.current_component;
    if (__iflet_2 !== null && __iflet_2 !== undefined) {
      const component_name = __iflet_2;
      const sanitized = sanitize_name(component_name);
      const updated_components = this.state.components.map((c) => (() => {
        if ((c.name === sanitized)) {
          return { name: c.name, has_state: c.has_state, has_effects: true };
        } else {
          return c;
        }
      })());
      this.state.components = updated_components;
    }
    this.state.builder.push("    public void OnInitialized() { }");
    return this.state.builder.push("\n");
  }
  
  
  function count_components_with_state(components) {
    let count = 0;
    for (const component of components) {
      if (component.has_state) {
        count += 1;
      }
    }
    return count;
  }
  
  
  function get_component_names(components) {
    return components.map((c) => c.name);
  }
  
  
  function find_component(components, name) {
    return components.find((c) => (c.name === name));
  }
  
  
  function to_camel_case(s) {
    if ((s.length === 0)) {
      return s;
    }
    const first = s[0];
    return `${first.toLowerCase()}${s.slice(1)}`;
  }
  
  
  function to_snake_case(s) {
    return s.toLowerCase().replace(" ", "_");
  }
  
  // Pre-hook
  
  function init() {
    return { builder: [], components: [], current_component: null };
  }
  
  // Exit hook
  
  function finish() {
    let final_output = "";
    final_output += "using System;\n";
    final_output += "using System.Collections.Generic;\n";
    final_output += "\n";
    final_output += "namespace Generated\n";
    final_output += "{\n";
    final_output += this.state.builder.join("");
    final_output += "}\n";
    const component_count = this.state.components.length;
    final_output += `
// Generated ${component_count} components
`;
    return final_output;
  }
  
  return {
    pre(file) {
      init(file);
    },
    
    visitor: {
      Program: {
        exit(path, state) {
          finish(path.node, state, builder);
        }
      },
      
      FunctionDeclaration(path) {
        const node = path.node;
        const name = node.id.name;
        if (is_component(name)) {
          const sanitized = sanitize_name(name);
          this.state.current_component = name;
          const metadata = { name: sanitized, has_state: false, has_effects: false };
          this.state.builder.push("public class ");
          this.state.builder.push(sanitized);
          this.state.builder.push("\n");
          this.state.builder.push("{");
          this.state.builder.push("\n");
          /* Babel auto-traverses */;
          this.state.builder.push("}");
          this.state.builder.push("\n");
          this.state.builder.push("\n");
          this.state.components.push(metadata);
          this.state.current_component = null;
        }
      },
      CallExpression(path) {
        const node = path.node;
        const __iflet_3 = get_callee_name(node.callee);
        if (__iflet_3 !== null && __iflet_3 !== undefined) {
          const callee_name = __iflet_3;
          if ((callee_name === "useState")) {
            this.extract_state_var();
          } else {
            if ((callee_name === "useEffect")) {
              this.extract_effect();
            }
          }
        }
        /* Babel auto-traverses */;
      },
      Identifier(path) {
        const node = path.node;
        const _name = node.name;
      },
      JSXElement(path) {
        const node = path.node;
        this.state.builder.push("    // JSX element");
        this.state.builder.push("\n");
        /* Babel auto-traverses */;
      },
    }
  };
};
