// Generated by ReluxScript compiler
// Do not edit manually

use swc_common::{Span, DUMMY_SP};
use swc_ecma_ast::*;
use swc_ecma_visit::{VisitMut, VisitMutWith};

#[derive(Debug, Clone)]
pub struct UseStateInfo {
    pub var_name: String,
    pub setter_name: Option<String>,
    pub initial_value: String,
    pub state_type: String,
    pub is_client_state: bool,
}

#[derive(Debug, Clone)]
pub struct Component {
    pub use_state: Vec<UseStateInfo>,
    pub use_client_state: Vec<UseStateInfo>,
}

pub struct ExtractUseStateTest {
    // Plugin state
}

impl ExtractUseStateTest {
    pub fn new() -> Self {
        Self {}
    }
    
    pub fn extract_use_state(call: &CallExpr, var_name: &Pat, component: &mut Component, hook_type: &String) {
        if let Pat::Array(var_name) = &var_name {
            let arr = var_name.clone();
            let mut state_var = None;
            if (arr.elements.len() > 0) {
                let first_elem = &arr.elements[0];
                if let Expr::Ident(first_elem) = &first_elem {
                    state_var = Some(first_elem.sym.clone());
                }
            }
            let mut setter_var = None;
            if (arr.elements.len() > 1) {
                let second_elem = &arr.elements[1];
                if let Expr::Ident(second_elem) = &second_elem {
                    setter_var = Some(second_elem.sym.clone());
                }
            }
            if let Some(name) = state_var {
                let mut initial_value = "null";
                let mut state_type = "dynamic";
                if (call.args.len() > 0) {
                    let first_arg = &call.args[0];
                    initial_value = generate_csharp_expression(first_arg);
                    state_type = infer_csharp_type(first_arg);
                }
                let info = UseStateInfo { var_name: name.clone(), setter_name: setter_var, initial_value: initial_value.to_string(), state_type: state_type.to_string(), is_client_state: (hook_type == "useClientState") };
                if (hook_type == "useClientState") {
                    component.use_client_state.push(info);
                } else {
                    component.use_state.push(info);
                }
            }
        }
    }
    
    fn generate_csharp_expression(expr: &Expr) -> String {
        if let Expr::Lit(Lit::Str(expr)) = &expr {
            let s = expr.value.clone();
            return format!("\"{}\"", s);
        } else if let Expr::Lit(Lit::Num(expr)) = &expr {
            return expr.value.to_string();
        } else if let Expr::Lit(Lit::Bool(expr)) = &expr {
            return expr.value.to_string();
        } else if let Expr::Lit(Lit::Null(expr)) = &expr {
            return "null";
        } else if let Expr::Ident(expr) = &expr {
            return expr.sym.clone();
        }
        return "null";
    }
    
    fn infer_csharp_type(expr: &Expr) -> String {
        if let Expr::Lit(Lit::Str(expr)) = &expr {
            return "string";
        } else if let Expr::Lit(Lit::Num(expr)) = &expr {
            return "int";
        } else if let Expr::Lit(Lit::Bool(expr)) = &expr {
            return "bool";
        } else if let Expr::Array(expr) = &expr {
            return "List<dynamic>";
        } else if let Expr::Object(expr) = &expr {
            return "Dictionary<string, dynamic>";
        }
        return "dynamic";
    }
}

impl VisitMut for ExtractUseStateTest {
}
